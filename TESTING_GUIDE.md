# 測試指南 - 登入/註冊系統

## 🎯 測試目標

驗證新的登入/註冊介面是否正常運作，包括：
- 角色選擇功能
- 共用元件的使用
- 表單驗證
- 角色分流

## 📋 測試前準備

### 1. 確保資料庫已更新

```bash
# 方法 1：執行完整的資料庫遷移（推薦用於新資料庫）
mysql -u root -p vue_auth < backend/migrations/add_user_role.sql

# 方法 2：如果遇到 "Unknown column 'failed_attempts'" 錯誤，執行快速修復
mysql -u root -p vue_auth < backend/migrations/fix_failed_attempts.sql
```

**注意：** 如果您在註冊時看到錯誤訊息 `(1054, "Unknown column 'failed_attempts' in 'field list'")`，請執行方法 2 的快速修復腳本。

### 2. 啟動後端

```bash
cd backend
python app.py
```

應該看到：
```
 * Running on http://127.0.0.1:5000
```

### 3. 啟動前端

```bash
cd frontend
npm run dev
```

應該看到：
```
  ➜  Local:   http://localhost:5173/
```

## 🧪 測試案例

### 測試 1：註冊顧客帳號

1. **訪問註冊頁面**
   - 打開 `http://localhost:5173/register`
   
2. **檢查介面元素**
   - ✅ 應該看到「註冊帳號」標題
   - ✅ 應該看到兩個角色卡片：「顧客」和「商家」
   - ✅ 應該看到使用共用元件的輸入框（帶圖標）
   
3. **選擇顧客角色**
   - 點擊「顧客」卡片
   - ✅ 卡片應該變成紫色漸層背景
   - ✅ 不應該顯示「商家資訊」區塊
   
4. **填寫表單**
   - 使用者名稱：`customer1`
   - 密碼：`123456`
   - 確認密碼：`123456`
   - 顯示名稱：`測試顧客`（選填）
   - 電子郵件：`customer@test.com`（選填）
   - 電話號碼：`0912345678`（選填）
   
5. **提交註冊**
   - 點擊「立即註冊」按鈕
   - ✅ 應該顯示「註冊成功！正在跳轉到登入頁面...」
   - ✅ 1.5 秒後自動跳轉到登入頁面

### 測試 2：註冊商家帳號

1. **訪問註冊頁面**
   - 打開 `http://localhost:5173/register`
   
2. **選擇商家角色**
   - 點擊「商家」卡片
   - ✅ 卡片應該變成紫色漸層背景
   - ✅ 應該顯示「商家資訊」區塊（淺藍色虛線邊框）
   
3. **填寫表單**
   - 使用者名稱：`merchant1`
   - 密碼：`123456`
   - 確認密碼：`123456`
   - 顯示名稱：`測試商家`
   - 電子郵件：`merchant@test.com`
   - 電話號碼：`0987654321`
   - **商家名稱**：`美味餐廳`（必填）
   - 商家類型：`中式料理`（選填）
   - 商家地址：`台北市信義區`（選填）
   
4. **提交註冊**
   - 點擊「立即註冊」按鈕
   - ✅ 應該顯示「註冊成功！正在跳轉到登入頁面...」
   - ✅ 1.5 秒後自動跳轉到登入頁面

### 測試 3：表單驗證

1. **測試未選擇角色**
   - 不選擇角色，直接填寫表單並提交
   - ✅ 應該顯示錯誤：「請選擇您的身分（顧客或商家）」
   
2. **測試使用者名稱長度**
   - 選擇角色，輸入少於 4 個字元的使用者名稱
   - ✅ 應該在輸入框下方顯示錯誤：「使用者名稱至少需要 4 個字元」
   
3. **測試密碼長度**
   - 輸入少於 6 個字元的密碼
   - ✅ 應該顯示錯誤：「密碼至少需要 6 個字元」
   
4. **測試密碼不一致**
   - 密碼和確認密碼輸入不同
   - ✅ 應該顯示錯誤：「兩次密碼輸入不一致」
   
5. **測試商家名稱必填**
   - 選擇商家角色，但不填寫商家名稱
   - ✅ 應該顯示錯誤：「請輸入商家名稱」

### 測試 4：顧客登入

1. **訪問登入頁面**
   - 打開 `http://localhost:5173/login`
   
2. **檢查介面元素**
   - ✅ 應該看到「歡迎回來」標題
   - ✅ 應該看到使用共用元件的輸入框
   - ✅ 應該看到驗證碼圖片
   - ✅ 應該看到 LINE 和 Google 登入按鈕
   
3. **填寫表單**
   - 使用者名稱：`customer1`
   - 密碼：`123456`
   - 驗證碼：輸入圖片中的驗證碼
   
4. **提交登入**
   - 點擊「立即登入」按鈕
   - ✅ 應該成功登入
   - ✅ 應該導向首頁 `/`（目前是 Dashboard，未來會改為餐廳首頁）

### 測試 5：商家登入

1. **訪問登入頁面**
   - 打開 `http://localhost:5173/login`
   
2. **填寫表單**
   - 使用者名稱：`merchant1`
   - 密碼：`123456`
   - 驗證碼：輸入圖片中的驗證碼
   
3. **提交登入**
   - 點擊「立即登入」按鈕
   - ✅ 應該成功登入
   - ✅ 應該導向 Dashboard `/dashboard`

### 測試 6：驗證碼功能

1. **自動載入驗證碼**
   - 打開登入頁面
   - ✅ 應該自動載入驗證碼圖片
   
2. **點擊圖片重新載入**
   - 點擊驗證碼圖片
   - ✅ 應該載入新的驗證碼
   - ✅ 驗證碼輸入框應該被清空
   
3. **點擊重新載入按鈕**
   - 點擊「重新載入」按鈕
   - ✅ 應該載入新的驗證碼
   - ✅ 驗證碼輸入框應該被清空

### 測試 7：響應式設計

1. **桌面版（> 640px）**
   - ✅ 角色卡片應該並排顯示（2 列）
   - ✅ OAuth 按鈕應該並排顯示
   
2. **手機版（< 640px）**
   - 調整瀏覽器寬度到 < 640px
   - ✅ 角色卡片應該垂直堆疊（1 列）
   - ✅ OAuth 按鈕應該垂直堆疊
   - ✅ 驗證碼容器應該垂直堆疊

## 🔍 檢查資料庫

### 查看註冊的用戶

```sql
USE vue_auth;

-- 查看所有用戶
SELECT id, username, role, display_name, email, phone, created_at 
FROM users 
ORDER BY created_at DESC;

-- 查看商家資訊
SELECT m.*, u.username 
FROM merchants m 
JOIN users u ON m.user_id = u.id;
```

**預期結果：**
- `customer1` 的 `role` 應該是 `customer`
- `merchant1` 的 `role` 應該是 `merchant`
- `merchant1` 應該在 `merchants` 表中有對應記錄

## ✅ 測試檢查清單

- [ ] 註冊頁面顯示正常
- [ ] 角色選擇功能正常
- [ ] 顧客註冊成功
- [ ] 商家註冊成功（包含商家資訊）
- [ ] 表單驗證正常運作
- [ ] 登入頁面顯示正常
- [ ] 驗證碼載入和刷新正常
- [ ] 顧客登入成功並導向正確頁面
- [ ] 商家登入成功並導向 Dashboard
- [ ] 響應式設計在不同螢幕尺寸下正常
- [ ] 資料庫中正確儲存角色和商家資訊

## 🐛 常見問題

### 問題 1：註冊時出現 "Unknown column 'failed_attempts'" 錯誤
**錯誤訊息：**
```
(1054, "Unknown column 'failed_attempts' in 'field list'")
```

**解決方案：**
```bash
# 執行快速修復腳本
mysql -u root -p vue_auth < backend/migrations/fix_failed_attempts.sql
```

**說明：** 這是因為資料庫中缺少 `failed_attempts` 和 `lockout_until` 欄位。執行修復腳本後，重新啟動後端服務即可。

### 問題 2：驗證碼載入失敗
**解決方案：**
- 確認後端正在運行
- 檢查瀏覽器控制台是否有 CORS 錯誤
- 確認 `.env` 中的 `CAPTCHA_SECRET_KEY` 已設定

### 問題 3：註冊後沒有跳轉
**解決方案：**
- 檢查瀏覽器控制台的錯誤訊息
- 確認後端 API 返回成功訊息
- 檢查網路請求是否成功（F12 → Network）

### 問題 4：商家資訊沒有儲存
**解決方案：**
- 確認資料庫遷移已執行
- 檢查 `merchants` 表是否存在
- 查看後端控制台的錯誤訊息

## 📝 測試報告範本

```
測試日期：____________________
測試人員：____________________

測試結果：
✅ 通過  ❌ 失敗  ⚠️ 部分通過

[ ] 測試 1：註冊顧客帳號
[ ] 測試 2：註冊商家帳號
[ ] 測試 3：表單驗證
[ ] 測試 4：顧客登入
[ ] 測試 5：商家登入
[ ] 測試 6：驗證碼功能
[ ] 測試 7：響應式設計

問題記錄：
_________________________________
_________________________________
_________________________________
```

---

**測試完成後，請確保所有功能都正常運作再進行下一步開發！**

